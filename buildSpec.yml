version: 0.2

phases:
  pre_build:
    commands:
      - set -x 
  build:
    commands:
      - sam build -b ./build --use-container -m ./requirements.txt
      - mv ./build/ServiceApiFunction/* ./src/
      - rm -rf ./build
      - sam package --template-file template.yaml --use-json --s3-bucket ${hw_stack_bucket_name} --s3-prefix ${hw_stack_name} --output-template-file built_template.json
      - sam deploy --template-file built_template.json --stack-name ${hw_stack_name} --capabilities CAPABILITY_IAM
      - echo "Done!"
